<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>X-Wing Squadron Builder</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #222; color: #fff; }
    .container { width: 80%; margin: auto; }
    .ship-section { margin-bottom: 20px; border: 1px solid #555; padding: 10px; background-color: #333; }
    .pilot-select, .upgrade-select { width: 100%; margin-bottom: 10px; }
    .points { font-size: 20px; text-align: center; margin-top: 10px; }
    .upgrade-limit, .upgrade-points { font-size: 14px; color: #bbb; margin-top: 5px; }
    .warning { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>X-Wing Squadron Builder</h2>
    <div id="squadron"></div>
    <button onclick="addShip()">Add Ship</button>
    <div class="points">Total Squadron Points: <span id="totalSquadPoints">0</span>/20</div>
    <div class="points">Pilot Points: <span id="totalPilotPoints">0</span></div>
    <div class="points">Upgrade Points: <span id="totalUpgradePoints">0</span></div>
  </div>

  <script>
    let ships = {
      "T-65 X-wing": {
        // Przywrócono oryginalne ustawienie forceSlots dla Luke Skywalkera (2 sloty na moc)
        "Luke Skywalker": { cost: 6, upgradeLimit: 24, force: 2, forceSlots: 2 },
        "Wedge Antilles": { cost: 6, upgradeLimit: 20, force: 0, talentSlots: 2 },
        "Biggs Darklighter": { cost: 5, upgradeLimit: 5, force: 0 },
        "Wes Janson": { cost: 5, upgradeLimit: 17, force: 0, missileSlots: 1 },
        "Corran Horn": { cost: 4, upgradeLimit: 9, force: 0, missileSlots: 1, noModifications: true },
        "Thane Kyrell": { cost: 4, upgradeLimit: 6, force: 0, missileSlots: 1, noModifications: true },
        "Garven Dreis": { cost: 4, upgradeLimit: 6, force: 0, missileSlots: 1, noModifications: true },
        "Jek Porkins": { cost: 4, upgradeLimit: 6, force: 0, missileSlots: 1, noModifications: true },
        "Kubllbee Sperado": { cost: 4, upgradeLimit: 9, force: 0, missileSlots: 1, noModifications: true },
        "Leevan Tenza": { cost: 4, upgradeLimit: 9, force: 0, missileSlots: 1, noModifications: true },
        "Red Squadron Veteran": { cost: 4, upgradeLimit: 8, force: 0, missileSlots: 1, noModifications: true },
        "Blue Squadron Escort": { cost: 5, upgradeLimit: 18, force: 0, missileSlots: 1, noModifications: true },
        "Edrio Two Tubes": { cost: 5, upgradeLimit: 18, force: 0, missileSlots: 1, noModifications: true },
        "Cabern Angels Zealot": { cost: 5, upgradeLimit: 15, force: 0 }
      },
      "Y-wing": {
        "Horton Salm": { cost: 4, upgradeLimit: 16, force: 0 },
        "Dutch Vander": { cost: 4, upgradeLimit: 10, force: 0 },
        "Norra Wexley": { cost: 5, upgradeLimit: 25, force: 0 },
        "Pops Krail": { cost: 3, upgradeLimit: 4, force: 0 },
        "Evaana Verliane": { cost: 3, upgradeLimit: 5, force: 0, modificationSlots: 2 },
        "Gray Squadron Bomber": { cost: 4, upgradeLimit: 18, force: 0 },
        "Gold Squadron Veteran": { cost: 3, upgradeLimit: 8, force: 0 }
      },
      "A-wing": {
        "Hera Syndulla": { cost: 3, upgradeLimit: 8, force: 0, talentSlots: 2 },
        // Zmieniono dla Ahsoki Tano – 2 mocy (force) oraz dedykowane ulepszenia
        "Ahsoka Tano": { cost: 4, upgradeLimit: 10, force: 2 },
        "Tycho Celchu": { cost: 3, upgradeLimit: 8, force: 0, talentSlots: 2},
        "Jake": { cost: 2, upgradeLimit: 6, force: 0 },
        "Farrel": { cost: 2, upgradeLimit: 6, force: 0 },
        "Shara Bey": { cost: 3, upgradeLimit: 8, force: 0 },
        "Wedge Antilles": { cost: 6, upgradeLimit: 20, force: 0, talentSlots: 2 },
        "Arvel Crynd": { cost: 3, upgradeLimit: 8, force: 0 },
        "Green Squadron Pilot": { cost: 2, upgradeLimit: 6, force: 0 },
        "Keo Venzee": { cost: 3, upgradeLimit: 8, force: 0 },
        "Derek Klivian": { cost: 3, upgradeLimit: 8, force: 0 },
        "Sabine Wren": { cost: 3, upgradeLimit: 8, force: 0 },
        "Phoenix Squadron Pilot": { cost: 2, upgradeLimit: 6, force: 0 }
      }
    };

    let upgrades = {
      "Force Upgrade": { "Sense": 5, "Supernatural Reflexes": 10, "Brilliant Evasion": 6 },
      "Talent Upgrade": { "Outmaneuver": 6, "Lone Wolf": 4 },
      "Torpedo Upgrade": { "Proton Torpedoes": 6, "Advanced Proton Torpedoes": 8 },
      "Missile Upgrade": { "Concussion Missiles": 5, "Cluster Missiles": 6 },
      "Astromech Upgrade": { "R2-D2": 5, "R5-D4": 3 },
      "Modification Upgrade": { "Shield Upgrade": 6, "Stealth Device": 5 },
      "Configuration Upgrade": { "S-Foils": 0 }
    };

    let yWingExtras = {
      "Bombs": { "Standard Bombs": 4, "Advanced Bombs": 6 },
      "Gunner": { "Standard Gunner": 3, "Veteran Gunner": 5 },
      "Turret": { "Standard Turret": 2, "Advanced Turret": 3 }
    };

    // Ulepszenia dedykowane dla A-wing (standardowe)
    let aWingExtras = {
      "Engine Upgrade": { "Afterburner": 3, "Supercharged Engine": 5 },
      "Weapon Upgrade": { "Dual Laser Cannons": 4, "Enhanced Laser Cannons": 6 },
      "Maneuver Upgrade": { "Agility Boost": 2, "Evasive Maneuvers": 4 }
    };

    let totalPilotPoints = 0;
    let totalUpgradePoints = 0;

    function addShip() {
      let squadronDiv = document.getElementById("squadron");
      let shipDiv = document.createElement("div");
      shipDiv.className = "ship-section";

      let shipSelect = document.createElement("select");
      shipSelect.innerHTML = `<option value=''>Select Ship</option>`;
      for (let ship in ships) {
        shipSelect.innerHTML += `<option value='${ship}'>${ship}</option>`;
      }
      shipSelect.onchange = function() { updatePilotOptions(shipDiv, shipSelect.value); };
      shipDiv.appendChild(shipSelect);

      let pilotSelect = document.createElement("select");
      pilotSelect.className = "pilot-select";
      pilotSelect.innerHTML = `<option value=''>Select Pilot</option>`;
      pilotSelect.onchange = () => updateUpgrades(shipDiv);
      shipDiv.appendChild(pilotSelect);

      let upgradeDiv = document.createElement("div");
      upgradeDiv.className = "upgrade-section";
      shipDiv.appendChild(upgradeDiv);

      let pointsDiv = document.createElement("div");
      pointsDiv.className = "upgrade-points";
      shipDiv.appendChild(pointsDiv);

      squadronDiv.appendChild(shipDiv);
    }

    function updatePilotOptions(shipDiv, selectedShip) {
      let pilotSelect = shipDiv.querySelector(".pilot-select");
      pilotSelect.innerHTML = `<option value=''>Select Pilot</option>`;
      if (ships[selectedShip]) {
        for (let pilot in ships[selectedShip]) {
          pilotSelect.innerHTML += `<option value='${pilot}'>${pilot} (${ships[selectedShip][pilot].cost} pts)</option>`;
        }
      }
      updateUpgrades(shipDiv);
      updateTotalPoints();
    }

    function updateUpgrades(shipDiv) {
      let pilotSelect = shipDiv.querySelector(".pilot-select");
      let upgradeSection = shipDiv.querySelector(".upgrade-section");
      let pointsDiv = shipDiv.querySelector(".upgrade-points");
      upgradeSection.innerHTML = "";
      pointsDiv.innerHTML = "";
      if (!pilotSelect.value) return;
      let selectedShip = shipDiv.querySelector("select").value;
      let pilotData = ships[selectedShip][pilotSelect.value];
      
      // Ustalenie flag dla poszczególnych pilotów
      let isLukeSkywalker      = pilotSelect.value === "Luke Skywalker";
      let isWedgeAntilles      = pilotSelect.value === "Wedge Antilles";
      let isHortonSalm         = pilotSelect.value === "Horton Salm";
      let isDutchVander        = pilotSelect.value === "Dutch Vander";
      let isNorraWexley        = pilotSelect.value === "Norra Wexley";
      let isPopsKrail          = pilotSelect.value === "Pops Krail";
      let isEvaanaVerliane     = pilotSelect.value === "Evaana Verliane";
      let isGrayBomber         = pilotSelect.value === "Gray Squadron Bomber";
      let isGoldVeteran        = pilotSelect.value === "Gold Squadron Veteran";
      let isBiggsDarklighter   = pilotSelect.value === "Biggs Darklighter";
      let isRedSquadronVeteran = pilotSelect.value === "Red Squadron Veteran";
      let isBlueSquadronEscort = pilotSelect.value === "Blue Squadron Escort";
      let isEdrioTwoTubess     = pilotSelect.value === "Edrio Two Tubes"; // zgodnie z literówką
      let isCabernAngelsZealot = pilotSelect.value === "Cabern Angels Zealot";
      let isHeraSyndulla       = pilotSelect.value === "Hera Syndulla";
      let isAhsokaTano         = pilotSelect.value === "Ahsoka Tano";
      
      let totalUpgradePointsForShip = 0;
      let talentSlots = pilotData.talentSlots || 1;

      // Specjalna logika dla Ahsoki Tano – 2 Force, 1 Rocket, 2 Modification oraz 1 Configuration
      if (isAhsokaTano) {
        upgradeSection.innerHTML = ""; // czyścimy dotychczasowe selektory

        // 2 sloty na Force Upgrade
        for (let i = 0; i < 2; i++) {
          let select = document.createElement("select");
          select.className = "upgrade-select";
          select.dataset.category = "Force Upgrade";
          select.innerHTML = `<option value=''>No Force Upgrade (Slot ${i+1})</option>`;
          for (let upgrade in upgrades["Force Upgrade"]) {
            select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades["Force Upgrade"][upgrade]} pts)</option>`;
          }
          select.onchange = function() {
            totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
            pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
            updateTotalPoints();
          };
          upgradeSection.appendChild(select);
        }

        // 1 slot na Rocket Upgrade (bazujemy na wartościach z Torpedo Upgrade)
        let selectRocket = document.createElement("select");
        selectRocket.className = "upgrade-select";
        selectRocket.dataset.category = "Rocket Upgrade";
        selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
        for (let upgrade in upgrades["Torpedo Upgrade"]) {
          let rocketName = upgrade.replace("Torpedoes", "Rockets");
          selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades["Torpedo Upgrade"][upgrade]} pts)</option>`;
        }
        selectRocket.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(selectRocket);

        // 2 sloty na Modification Upgrade
        for (let i = 0; i < 2; i++) {
          let select = document.createElement("select");
          select.className = "upgrade-select";
          select.dataset.category = "Modification Upgrade";
          select.innerHTML = `<option value=''>No Modification Upgrade (Slot ${i+1})</option>`;
          for (let upgrade in upgrades["Modification Upgrade"]) {
            select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades["Modification Upgrade"][upgrade]} pts)</option>`;
          }
          select.onchange = function() {
            totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
            pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
            updateTotalPoints();
          };
          upgradeSection.appendChild(select);
        }

        // 1 slot na Configuration Upgrade
        let selectConfig = document.createElement("select");
        selectConfig.className = "upgrade-select";
        selectConfig.dataset.category = "Configuration Upgrade";
        selectConfig.innerHTML = `<option value=''>No Configuration Upgrade</option>`;
        for (let upgrade in upgrades["Configuration Upgrade"]) {
          selectConfig.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades["Configuration Upgrade"][upgrade]} pts)</option>`;
        }
        selectConfig.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(selectConfig);
        
        return;
      }

      // Specjalna logika dla Hery Syndulli
      if (isHeraSyndulla) {
        upgradeSection.innerHTML = ""; // czyścimy dotychczasowe selektory

        // 2 sloty na Talent Upgrade
        for (let i = 0; i < 2; i++) {
          let select = document.createElement("select");
          select.className = "upgrade-select";
          select.dataset.category = "Talent Upgrade";
          select.innerHTML = `<option value=''>No Talent Upgrade (Slot ${i+1})</option>`;
          for (let upgrade in upgrades["Talent Upgrade"]) {
            select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades["Talent Upgrade"][upgrade]} pts)</option>`;
          }
          select.onchange = function() {
            totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
            pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
            updateTotalPoints();
          };
          upgradeSection.appendChild(select);
        }

        // 1 slot na Rocket Upgrade (bazujemy na wartościach z Torpedo Upgrade)
        let selectRocketHera = document.createElement("select");
        selectRocketHera.className = "upgrade-select";
        selectRocketHera.dataset.category = "Rocket Upgrade";
        selectRocketHera.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
        for (let upgrade in upgrades["Torpedo Upgrade"]) {
          let rocketName = upgrade.replace("Torpedoes", "Rockets");
          selectRocketHera.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades["Torpedo Upgrade"][upgrade]} pts)</option>`;
        }
        selectRocketHera.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(selectRocketHera);

        // 1 slot na Sensor Upgrade (nowa kategoria)
        let sensorUpgrades = {
          "Long Range Sensors": 5,
          "Advanced Sensors": 7
        };
        let selectSensor = document.createElement("select");
        selectSensor.className = "upgrade-select";
        selectSensor.dataset.category = "Sensor Upgrade";
        selectSensor.innerHTML = `<option value=''>No Sensor Upgrade</option>`;
        for (let upgrade in sensorUpgrades) {
          selectSensor.innerHTML += `<option value='${upgrade}'>${upgrade} (${sensorUpgrades[upgrade]} pts)</option>`;
        }
        selectSensor.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(selectSensor);

        // 1 slot na Modification Upgrade
        let selectMod = document.createElement("select");
        selectMod.className = "upgrade-select";
        selectMod.dataset.category = "Modification Upgrade";
        selectMod.innerHTML = `<option value=''>No Modification Upgrade</option>`;
        for (let upgrade in upgrades["Modification Upgrade"]) {
          selectMod.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades["Modification Upgrade"][upgrade]} pts)</option>`;
        }
        selectMod.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(selectMod);

        // 1 slot na Configuration Upgrade
        let selectConfigHera = document.createElement("select");
        selectConfigHera.className = "upgrade-select";
        selectConfigHera.dataset.category = "Configuration Upgrade";
        selectConfigHera.innerHTML = `<option value=''>No Configuration Upgrade</option>`;
        for (let upgrade in upgrades["Configuration Upgrade"]) {
          selectConfigHera.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades["Configuration Upgrade"][upgrade]} pts)</option>`;
        }
        selectConfigHera.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(selectConfigHera);

        return;
      }

      // Dla pozostałych pilotów – kontynuujemy dotychczasową logikę

      for (let category in upgrades) {
        if ((["Corran Horn", "Thane Kyrell", "Jek Porkins", "Kubllbee Sperado"].includes(pilotSelect.value)) && category === "Modification Upgrade") {
          continue;
        }

        if (isGrayBomber) {
          if (category === "Astromech Upgrade" || category === "Modification Upgrade") {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category}</option>`;
            for (let upgrade in upgrades[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          } else if (category === "Torpedo Upgrade") {
            let selectRocket = document.createElement("select");
            selectRocket.className = "upgrade-select";
            selectRocket.dataset.category = "Rocket Upgrade";
            selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              let rocketName = upgrade.replace("Torpedoes", "Rockets");
              selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectRocket.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectRocket);
          }
          continue;
        }
        if (isGoldVeteran) {
          if (category === "Torpedo Upgrade") {
            let selectRocket = document.createElement("select");
            selectRocket.className = "upgrade-select";
            selectRocket.dataset.category = "Rocket Upgrade";
            selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              let rocketName = upgrade.replace("Torpedoes", "Rockets");
              selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectRocket.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectRocket);
          } else if (category === "Modification Upgrade") {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category}</option>`;
            for (let upgrade in upgrades[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          }
          continue;
        }
        
        if (isGoldVeteran && !(["Torpedo Upgrade", "Modification Upgrade"].includes(category))) {
          continue;
        }
        if ((isNorraWexley || isPopsKrail || isEvaanaVerliane) && !(["Talent Upgrade", "Torpedo Upgrade", "Astromech Upgrade", "Modification Upgrade"].includes(category))) {
          continue;
        }
        if (isRedSquadronVeteran && (category !== "Talent Upgrade" && category !== "Astromech Upgrade" && category !== "Configuration Upgrade")) {
          continue;
        }
        if (isBlueSquadronEscort && (category !== "Configuration Upgrade" && category !== "Astromech Upgrade" && category !== "Modification Upgrade" && category !== "Torpedo Upgrade")) {
          continue;
        }
        if (isEdrioTwoTubess && (category !== "Missile Upgrade" && category !== "Configuration Upgrade")) {
          continue;
        }
        if (isCabernAngelsZealot && (category !== "Astromech Upgrade" && category !== "Configuration Upgrade" && category !== "Modification Upgrade")) {
          continue;
        }
        if (selectedShip === "Y-wing" && category === "Configuration Upgrade") {
          continue;
        }
        if ((isLukeSkywalker || isBiggsDarklighter) && category === "Talent Upgrade") {
          continue;
        }
        if (isHortonSalm && category === "Talent Upgrade") {
          continue;
        }
        if ((["Corran Horn", "Jek Porkins", "Kubllbee Sperado"].includes(pilotSelect.value)) && category === "Modification Upgrade") {
          continue;
        }
        if ((["Corran Horn", "Wes Janson", "Thane Kyrell", "Jek Porkins", "Kubllbee Sperado"].includes(pilotSelect.value)) && category === "Torpedo Upgrade") {
          continue;
        }
        if ((!["Corran Horn", "Wes Janson", "Thane Kyrell", "Jek Porkins", "Kubllbee Sperado"].includes(pilotSelect.value)) &&
            category === "Missile Upgrade" && !isEdrioTwoTubess) {
          continue;
        }
        if (category === "Force Upgrade" && pilotData.force === 0) continue;
            
        if (isLukeSkywalker && category === "Force Upgrade") {
          let forceSlots = pilotData.forceSlots || 1;
          for (let i = 0; i < forceSlots; i++) {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category} (Slot ${i+1})</option>`;
            for (let upgrade in upgrades[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          }
          continue;
        }
        
        if (isWedgeAntilles && category === "Talent Upgrade") {
          for (let i = 0; i < talentSlots; i++) {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category} (Slot ${i+1})</option>`;
            for (let upgrade in upgrades[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          }
          continue;
        }
        
        if ((isHortonSalm || isDutchVander || isPopsKrail || isEvaanaVerliane || isGoldVeteran) && category === "Torpedo Upgrade") {
          if (isGoldVeteran) {
            let selectRocket = document.createElement("select");
            selectRocket.className = "upgrade-select";
            selectRocket.dataset.category = "Rocket Upgrade";
            selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              let rocketName = upgrade.replace("Torpedoes", "Rockets");
              selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectRocket.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectRocket);
            continue;
          } else {
            let selectTorpedo = document.createElement("select");
            selectTorpedo.className = "upgrade-select";
            selectTorpedo.dataset.category = "Torpedo Upgrade";
            selectTorpedo.innerHTML = `<option value=''>No Torpedo Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              selectTorpedo.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectTorpedo.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectTorpedo);
            
            let selectRocket = document.createElement("select");
            selectRocket.className = "upgrade-select";
            selectRocket.dataset.category = "Rocket Upgrade";
            selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              let rocketName = upgrade.replace("Torpedoes", "Rockets");
              selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectRocket.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectRocket);
            continue;
          }
        }
        
        if (isEvaanaVerliane && category === "Modification Upgrade") {
          let modSlots = pilotData.modificationSlots || 1;
          for (let i = 0; i < modSlots; i++) {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category} (Slot ${i+1})</option>`;
            for (let upgrade in upgrades[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          }
          continue;
        }
        
        let select = document.createElement("select");
        select.className = "upgrade-select";
        select.dataset.category = category;
        select.innerHTML = `<option value=''>No ${category}</option>`;
        for (let upgrade in upgrades[category]) {
          select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
        }
        select.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(select);
      }

      // Dodatkowe ulepszenia z obiektu yWingExtras (dotyczą statków Y-wing)
      if (selectedShip === "Y-wing") {
        for (let category in yWingExtras) {
          if (category === "Gunner" && !isNorraWexley) continue;
          if (isGrayBomber) {
            if (!(category === "Bombs" || category === "Turret")) continue;
          } else if (isGoldVeteran) {
            if (category !== "Turret") continue;
          }
          let slotCount = 1;
          if (isDutchVander && category === "Bombs") {
            slotCount = 2;
          }
          for (let i = 0; i < slotCount; i++) {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category}${slotCount > 1 ? " (Slot " + (i+1) + ")" : ""}</option>`;
            for (let upgrade in yWingExtras[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${yWingExtras[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          }
        }
      }

      // Dodatkowe ulepszenia dedykowane dla A-wing (standardowe)
      if (selectedShip === "A-wing") {
        for (let category in aWingExtras) {
          let select = document.createElement("select");
          select.className = "upgrade-select";
          select.dataset.category = category;
          select.innerHTML = `<option value=''>No ${category}</option>`;
          for (let upgrade in aWingExtras[category]) {
            select.innerHTML += `<option value='${upgrade}'>${upgrade} (${aWingExtras[category][upgrade]} pts)</option>`;
          }
          select.onchange = function() {
            totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
            pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
            updateTotalPoints();
          };
          upgradeSection.appendChild(select);
        }
      }

      // Slot na Illegal Upgrade pozostaje bez zmian
      if (["Kubllbee Sperado", "Leevan Tenza", "Edrio Two Tubes", "Cabern Angels Zealot"].includes(pilotSelect.value)) {
        let illegalSelect = document.createElement("select");
        illegalSelect.className = "upgrade-select";
        illegalSelect.dataset.category = "Illegal";
        illegalSelect.innerHTML = `<option value=''>No Illegal Upgrade</option>`;
        illegalSelect.innerHTML += `<option value='illegal'>Illegal Upgrade (3 pts)</option>`;
        illegalSelect.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(illegalSelect);
      }
    }

    function calculateUpgradePoints(shipDiv) {
      let total = 0;
      let selects = shipDiv.querySelectorAll(".upgrade-select");
      selects.forEach(select => {
        if (select.value) {
          if (select.value === 'illegal') {
            total += 3;
          } else if (select.dataset.category === "Rocket Upgrade") {
            let torpedoOptions = upgrades["Torpedo Upgrade"];
            for (let key in torpedoOptions) {
              let rocketName = key.replace("Torpedoes", "Rockets");
              if (rocketName === select.value) {
                total += torpedoOptions[key];
              }
            }
          } else {
            let cat = select.dataset.category;
            if (upgrades[cat] && upgrades[cat][select.value]) {
              total += upgrades[cat][select.value];
            } else if (yWingExtras[cat] && yWingExtras[cat][select.value]) {
              total += yWingExtras[cat][select.value];
            } else if (aWingExtras[cat] && aWingExtras[cat][select.value]) {
              total += aWingExtras[cat][select.value];
            } else if (cat === "Sensor Upgrade") {
              let sensorUpgrades = { "Long Range Sensors": 5, "Advanced Sensors": 7 };
              total += sensorUpgrades[select.value] || 0;
            }
          }
        }
      });
      return total;
    }

    function updateTotalPoints() {
      totalPilotPoints = 0;
      totalUpgradePoints = 0;
      let shipSections = document.querySelectorAll(".ship-section");
      shipSections.forEach(shipDiv => {
        let shipSelect = shipDiv.querySelector("select");
        let pilotSelect = shipDiv.querySelector(".pilot-select");
        if (shipSelect.value && pilotSelect.value) {
          let selectedShip = shipSelect.value;
          let selectedPilot = pilotSelect.value;
          let pilotData = ships[selectedShip][selectedPilot];
          totalPilotPoints += pilotData.cost;
          totalUpgradePoints += calculateUpgradePoints(shipDiv);
        }
      });
      document.getElementById("totalPilotPoints").innerText = totalPilotPoints;
      document.getElementById("totalUpgradePoints").innerText = totalUpgradePoints;
      document.getElementById("totalSquadPoints").innerText = `${totalPilotPoints + totalUpgradePoints}/20`;
    }
  </script>
</body>
</html>
