<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>X-Wing Squadron Builder</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #222; color: #fff; }
    .container { width: 80%; margin: auto; }
    .ship-section { margin-bottom: 20px; border: 1px solid #555; padding: 10px; background-color: #333; }
    .pilot-select, .upgrade-select { width: 100%; margin-bottom: 10px; }
    .points { font-size: 20px; text-align: center; margin-top: 10px; }
    .upgrade-limit, .upgrade-points { font-size: 14px; color: #bbb; margin-top: 5px; }
    .warning { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>X-Wing Squadron Builder</h2>
    <div id="squadron"></div>
    <button onclick="addShip()">Add Ship</button>
    <div class="points">Total Squadron Points: <span id="totalSquadPoints">0</span>/20</div>
    <div class="points">Pilot Points: <span id="totalPilotPoints">0</span></div>
    <div class="points">Upgrade Points: <span id="totalUpgradePoints">0</span></div>
  </div>

  <script>
    let ships = {
      "T-65 X-wing": {
        "Luke Skywalker": { cost: 6, upgradeLimit: 24, force: 2, forceSlots: 2 },
        "Wedge Antilles": { cost: 6, upgradeLimit: 20, force: 0, talentSlots: 2 },
        "Biggs Darklighter": { cost: 5, upgradeLimit: 5, force: 0 },
        "Wes Janson": { cost: 5, upgradeLimit: 17, force: 0, missileSlots: 1 },
        "Corran Horn": { cost: 4, upgradeLimit: 9, force: 0, missileSlots: 1, noModifications: true },
        "Thane Kyrell": { cost: 4, upgradeLimit: 6, force: 0, missileSlots: 1, noModifications: true },
        "Garven Dreis": { cost: 4, upgradeLimit: 6, force: 0, missileSlots: 1, noModifications: true },
        "Jek Porkins": { cost: 4, upgradeLimit: 6, force: 0, missileSlots: 1, noModifications: true },
        "Kubllbee Sperado": { cost: 4, upgradeLimit: 9, force: 0, missileSlots: 1, noModifications: true },
        "Leevan Tenza": { cost: 4, upgradeLimit: 9, force: 0, missileSlots: 1, noModifications: true },
        "Red Squadron Veteran": { cost: 4, upgradeLimit: 8, force: 0, missileSlots: 1, noModifications: true },
        "Blue Squadron Escort": { cost: 5, upgradeLimit: 18, force: 0, missileSlots: 1, noModifications: true },
        "Edrio Two Tubes": { cost: 5, upgradeLimit: 18, force: 0, missileSlots: 1, noModifications: true },
        "Cabern Angels Zealot": { cost: 5, upgradeLimit: 15, force: 0 }
      },
      "Y-wing": {
        "Horton Salm": { cost: 4, upgradeLimit: 16, force: 0 },
        "Dutch Vander": { cost: 4, upgradeLimit: 10, force: 0 },
        "Norra Wexley": { cost: 4, upgradeLimit: 16, force: 0 },
        "Pops Krail": { cost: 4, upgradeLimit: 16, force: 0 },
        // Istniejący pilot z modyfikacjami
        "Evaana Verliane": { cost: 4, upgradeLimit: 16, force: 0, modificationSlots: 2 },
        // Nowy pilot – Gold Squadron Veteran
        "Gold Squadron Veteran": { cost: 4, upgradeLimit: 16, force: 0, modificationSlots: 1 }
      }
    };

    let upgrades = {
      "Force Upgrade": { "Sense": 5, "Supernatural Reflexes": 10, "Brilliant Evasion": 6 },
      "Talent Upgrade": { "Outmaneuver": 6, "Lone Wolf": 4 },
      "Torpedo Upgrade": { "Proton Torpedoes": 6, "Advanced Proton Torpedoes": 8 },
      "Missile Upgrade": { "Concussion Missiles": 5, "Cluster Missiles": 6 },
      "Astromech Upgrade": { "R2-D2": 5, "R5-D4": 3 },
      "Modification Upgrade": { "Shield Upgrade": 6, "Stealth Device": 5 },
      "Configuration Upgrade": { "S-Foils": 0 }
    };

    let yWingExtras = {
      "Bombs": { "Standard Bombs": 4, "Advanced Bombs": 6 },
      "Gunner": { "Standard Gunner": 3, "Veteran Gunner": 5 },
      "Turret": { "Standard Turret": 2, "Advanced Turret": 3 }
    };

    let totalPilotPoints = 0;
    let totalUpgradePoints = 0;

    function addShip() {
      let squadronDiv = document.getElementById("squadron");
      let shipDiv = document.createElement("div");
      shipDiv.className = "ship-section";

      let shipSelect = document.createElement("select");
      shipSelect.innerHTML = `<option value=''>Select Ship</option>`;
      for (let ship in ships) {
        shipSelect.innerHTML += `<option value='${ship}'>${ship}</option>`;
      }
      shipSelect.onchange = function() { updatePilotOptions(shipDiv, shipSelect.value); };
      shipDiv.appendChild(shipSelect);

      let pilotSelect = document.createElement("select");
      pilotSelect.className = "pilot-select";
      pilotSelect.innerHTML = `<option value=''>Select Pilot</option>`;
      pilotSelect.onchange = () => updateUpgrades(shipDiv);
      shipDiv.appendChild(pilotSelect);

      let upgradeDiv = document.createElement("div");
      upgradeDiv.className = "upgrade-section";
      shipDiv.appendChild(upgradeDiv);

      let pointsDiv = document.createElement("div");
      pointsDiv.className = "upgrade-points";
      shipDiv.appendChild(pointsDiv);

      squadronDiv.appendChild(shipDiv);
    }

    function updatePilotOptions(shipDiv, selectedShip) {
      let pilotSelect = shipDiv.querySelector(".pilot-select");
      pilotSelect.innerHTML = `<option value=''>Select Pilot</option>`;
      if (ships[selectedShip]) {
        for (let pilot in ships[selectedShip]) {
          pilotSelect.innerHTML += `<option value='${pilot}'>${pilot} (${ships[selectedShip][pilot].cost} pts)</option>`;
        }
      }
      updateUpgrades(shipDiv);
      updateTotalPoints();
    }

    function updateUpgrades(shipDiv) {
      let pilotSelect = shipDiv.querySelector(".pilot-select");
      let upgradeSection = shipDiv.querySelector(".upgrade-section");
      let pointsDiv = shipDiv.querySelector(".upgrade-points");
      upgradeSection.innerHTML = "";
      pointsDiv.innerHTML = "";

      if (!pilotSelect.value) return;

      let selectedShip = shipDiv.querySelector("select").value;
      let pilotData = ships[selectedShip][pilotSelect.value];

      // Ustalamy flagi dla pilotów
      let isLukeSkywalker = pilotSelect.value === "Luke Skywalker";
      let isWedgeAntilles = pilotSelect.value === "Wedge Antilles";
      let isHortonSalm = pilotSelect.value === "Horton Salm";
      let isDutchVander = pilotSelect.value === "Dutch Vander";
      let isNorraWexley = pilotSelect.value === "Norra Wexley";
      let isPopsKrail = pilotSelect.value === "Pops Krail";
      let isEvaanaVerliane = pilotSelect.value === "Evaana Verliane";
      let isGoldSquadronVeteran = pilotSelect.value === "Gold Squadron Veteran";
      let isBiggsDarklighter = pilotSelect.value === "Biggs Darklighter";
      let isRedSquadronVeteran = pilotSelect.value === "Red Squadron Veteran";
      let isBlueSquadronEscort = pilotSelect.value === "Blue Squadron Escort";
      let isEdrioTwoTubess = pilotSelect.value === "Edrio Two Tubes";
      let isCabernAngelsZealot = pilotSelect.value === "Cabern Angels Zealot";

      let totalUpgradePointsForShip = 0;
      let talentSlots = pilotData.talentSlots || 1;

      // Iteracja po kategoriach upgrade’ów z obiektu upgrades
      for (let category in upgrades) {
        // Jeśli pilot Gold Squadron Veteran – dopuszczamy tylko Modification Upgrade oraz Torpedo Upgrade (dla rakiet)
        if (isGoldSquadronVeteran && category !== "Modification Upgrade" && category !== "Torpedo Upgrade") {
          continue;
        }
        // Standardowe warunki dla pozostałych pilotów (pomijamy tutaj inne kategorie, jeśli nie są dozwolone)
        if (!isGoldSquadronVeteran) {
          if (isEvaanaVerliane && !(["Torpedo Upgrade", "Astromech Upgrade", "Modification Upgrade"].includes(category))) continue;
          if ((isNorraWexley || isPopsKrail) && !(["Talent Upgrade", "Torpedo Upgrade", "Astromech Upgrade", "Modification Upgrade"].includes(category))) continue;
          if (isRedSquadronVeteran && (category !== "Talent Upgrade" && category !== "Astromech Upgrade" && category !== "Configuration Upgrade")) continue;
          if (isBlueSquadronEscort && (category !== "Configuration Upgrade" && category !== "Astromech Upgrade" && category !== "Modification Upgrade" && category !== "Torpedo Upgrade")) continue;
          if (isEdrioTwoTubess && (category !== "Missile Upgrade" && category !== "Configuration Upgrade")) continue;
          if (isCabernAngelsZealot && (category !== "Astromech Upgrade" && category !== "Configuration Upgrade" && category !== "Modification Upgrade")) continue;
          if (selectedShip === "Y-wing" && category === "Configuration Upgrade") continue;
          if ((isLukeSkywalker || isBiggsDarklighter) && category === "Talent Upgrade") continue;
          if (isHortonSalm && category === "Talent Upgrade") continue;
          if ((pilotSelect.value === "Corran Horn" || pilotSelect.value === "Wes Janson" ||
               pilotSelect.value === "Jek Porkins" || pilotSelect.value === "Kubllbee Sperado") && category === "Modification Upgrade") continue;
          if ((pilotSelect.value === "Corran Horn" || pilotSelect.value === "Wes Janson" ||
               pilotSelect.value === "Jek Porkins" || pilotSelect.value === "Kubllbee Sperado") && category === "Torpedo Upgrade") continue;
          if ((pilotSelect.value !== "Corran Horn" && pilotSelect.value !== "Wes Janson" &&
               pilotSelect.value !== "Jek Porkins" && pilotSelect.value !== "Kubllbee Sperado") &&
               category === "Missile Upgrade" && !isEdrioTwoTubess) continue;
          if (category === "Force Upgrade" && pilotData.force === 0) continue;
        }

        // Jeśli kategoria to Force Upgrade – specyficzne sloty dla Luke Skywalker
        if (isLukeSkywalker && category === "Force Upgrade") {
          let forceSlots = pilotData.forceSlots || 1;
          for (let i = 0; i < forceSlots; i++) {
            let select = document.createElement("select");
            select.className = "upgrade-select";
            select.dataset.category = category;
            select.innerHTML = `<option value=''>No ${category} (Slot ${i+1})</option>`;
            for (let upgrade in upgrades[category]) {
              select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            select.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(select);
          }
          continue;
        }

        // Jeśli kategoria to Torpedo Upgrade – inaczej obsługujemy dla Gold Squadron Veteran
        if (category === "Torpedo Upgrade") {
          if (isGoldSquadronVeteran) {
            // Dla Gold Squadron Veteran wyświetlamy tylko slot dla rakiet (z modyfikowaną nazwą upgrade’a)
            let selectRocket = document.createElement("select");
            selectRocket.className = "upgrade-select";
            selectRocket.dataset.category = "Rocket Upgrade";
            selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              let rocketName = upgrade.replace("Torpedoes", "Rockets");
              selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectRocket.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectRocket);
          } else {
            // Dla pozostałych pilotów – standardowo dodajemy sloty dla torped i rakiet
            let selectTorpedo = document.createElement("select");
            selectTorpedo.className = "upgrade-select";
            selectTorpedo.dataset.category = "Torpedo Upgrade";
            selectTorpedo.innerHTML = `<option value=''>No Torpedo Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              selectTorpedo.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectTorpedo.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectTorpedo);

            let selectRocket = document.createElement("select");
            selectRocket.className = "upgrade-select";
            selectRocket.dataset.category = "Rocket Upgrade";
            selectRocket.innerHTML = `<option value=''>No Rocket Upgrade</option>`;
            for (let upgrade in upgrades[category]) {
              let rocketName = upgrade.replace("Torpedoes", "Rockets");
              selectRocket.innerHTML += `<option value='${rocketName}'>${rocketName} (${upgrades[category][upgrade]} pts)</option>`;
            }
            selectRocket.onchange = function() {
              totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
              pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
              updateTotalPoints();
            };
            upgradeSection.appendChild(selectRocket);
          }
          continue;
        }

        // Dla pozostałych kategorii (dla Gold Squadron Veteran wyjdą tylko Modification Upgrade)
        let select = document.createElement("select");
        select.className = "upgrade-select";
        select.dataset.category = category;
        select.innerHTML = `<option value=''>No ${category}</option>`;
        for (let upgrade in upgrades[category]) {
          select.innerHTML += `<option value='${upgrade}'>${upgrade} (${upgrades[category][upgrade]} pts)</option>`;
        }
        select.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(select);
      }

      // Sekcja dodatkowych upgrade’ów dla Y-wing
      if (selectedShip === "Y-wing") {
        for (let category in yWingExtras) {
          // Dla Gold Squadron Veteran wyświetlamy tylko slot dla Turret (wieżyczki)
          if (isGoldSquadronVeteran && category !== "Turret") continue;
          // Dla Dutch Vander – dla Bombs dodajemy 2 sloty
          if (isDutchVander && category === "Bombs") {
            for (let i = 0; i < 2; i++) {
              let select = document.createElement("select");
              select.className = "upgrade-select";
              select.dataset.category = category;
              select.innerHTML = `<option value=''>No ${category} (Slot ${i+1})</option>`;
              for (let upgrade in yWingExtras[category]) {
                select.innerHTML += `<option value='${upgrade}'>${upgrade} (${yWingExtras[category][upgrade]} pts)</option>`;
              }
              select.onchange = function() {
                totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
                pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
                updateTotalPoints();
              };
              upgradeSection.appendChild(select);
            }
            continue;
          }
          // Pomijamy Gunner dla innych pilotów, jeśli nie jest dozwolony
          if (!isNorraWexley && !isPopsKrail && !isEvaanaVerliane && isGoldSquadronVeteran === false && category === "Gunner") continue;
          
          let select = document.createElement("select");
          select.className = "upgrade-select";
          select.dataset.category = category;
          select.innerHTML = `<option value=''>No ${category}</option>`;
          for (let upgrade in yWingExtras[category]) {
            select.innerHTML += `<option value='${upgrade}'>${upgrade} (${yWingExtras[category][upgrade]} pts)</option>`;
          }
          select.onchange = function() {
            totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
            pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
            updateTotalPoints();
          };
          upgradeSection.appendChild(select);
        }
      }

      // Slot na Illegal Upgrade (jeśli dotyczy)
      if (pilotSelect.value === "Kubllbee Sperado" || pilotSelect.value === "Leevan Tenza" || 
          pilotSelect.value === "Edrio Two Tubes" || pilotSelect.value === "Cabern Angels Zealot") {
        let illegalSelect = document.createElement("select");
        illegalSelect.className = "upgrade-select";
        illegalSelect.dataset.category = "Illegal";
        illegalSelect.innerHTML = `<option value=''>No Illegal Upgrade</option>`;
        illegalSelect.innerHTML += `<option value='illegal'>Illegal Upgrade (3 pts)</option>`;
        illegalSelect.onchange = function() {
          totalUpgradePointsForShip = calculateUpgradePoints(shipDiv);
          pointsDiv.innerHTML = `Used Points: ${totalUpgradePointsForShip}/${pilotData.upgradeLimit}`;
          updateTotalPoints();
        };
        upgradeSection.appendChild(illegalSelect);
      }
    }

    function calculateUpgradePoints(shipDiv) {
      let total = 0;
      let selects = shipDiv.querySelectorAll(".upgrade-select");
      selects.forEach(select => {
        if (select.value) {
          if (select.value === 'illegal') {
            total += 3;
          } else if (select.dataset.category === "Rocket Upgrade") {
            let torpedoOptions = upgrades["Torpedo Upgrade"];
            for (let key in torpedoOptions) {
              let rocketName = key.replace("Torpedoes", "Rockets");
              if (rocketName === select.value) {
                total += torpedoOptions[key];
              }
            }
          } else {
            let cat = select.dataset.category;
            if (upgrades[cat] && upgrades[cat][select.value]) {
              total += upgrades[cat][select.value];
            } else if (yWingExtras[cat] && yWingExtras[cat][select.value]) {
              total += yWingExtras[cat][select.value];
            }
          }
        }
      });
      return total;
    }

    function updateTotalPoints() {
      totalPilotPoints = 0;
      totalUpgradePoints = 0;

      let shipSections = document.querySelectorAll(".ship-section");
      shipSections.forEach(shipDiv => {
        let shipSelect = shipDiv.querySelector("select");
        let pilotSelect = shipDiv.querySelector(".pilot-select");

        if (shipSelect.value && pilotSelect.value) {
          let selectedShip = shipSelect.value;
          let selectedPilot = pilotSelect.value;
          let pilotData = ships[selectedShip][selectedPilot];

          totalPilotPoints += pilotData.cost;
          totalUpgradePoints += calculateUpgradePoints(shipDiv);
        }
      });

      document.getElementById("totalPilotPoints").innerText = totalPilotPoints;
      document.getElementById("totalUpgradePoints").innerText = totalUpgradePoints;
      document.getElementById("totalSquadPoints").innerText = `${totalPilotPoints + totalUpgradePoints}/20`;
    }
  </script>
</body>
</html>
